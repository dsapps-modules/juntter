<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1544px" preserveAspectRatio="none" style="width:1888px;height:1544px;background:#FFFFFF;" version="1.1" viewBox="0 0 1888 1544" width="1888px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="375" x="752.75" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="365" x="757.75" y="27.9951">Pagamento com Cartão via Link de Pagamento</text><rect fill="none" height="465.6016" style="stroke:#000000;stroke-width:1.5;" width="1861.5" x="10" y="763.8125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="47" x2="47" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="47" x2="47" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="343.5" x2="343.5" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="343.5" x2="343.5" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="343.5" x2="343.5" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="619" x2="619" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="619" x2="619" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="619" x2="619" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="898" x2="898" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="898" x2="898" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="898" x2="898" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1021" x2="1021" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1021" x2="1021" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1021" x2="1021" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1314" x2="1314" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1314" x2="1314" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1314" x2="1314" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1668.5" x2="1668.5" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1668.5" x2="1668.5" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1668.5" x2="1668.5" y1="866.0156" y2="1450.3438"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1793.5" x2="1793.5" y1="120.8906" y2="825.2109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1793.5" x2="1793.5" y1="825.2109" y2="866.0156"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1793.5" x2="1793.5" y1="866.0156" y2="1450.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="117.5889">Cliente</text><ellipse cx="47" cy="53.0938" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47,61.0938 L47,88.0938 M34,69.0938 L60,69.0938 M47,88.0938 L34,103.0938 M47,88.0938 L60,103.0938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="20" y="1462.3389">Cliente</text><ellipse cx="47" cy="1474.1406" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M47,1482.1406 L47,1509.1406 M34,1490.1406 L60,1490.1406 M47,1509.1406 L34,1524.1406 M47,1509.1406 L60,1524.1406 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107" x="290.5" y="73.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="297.5" y="93.292">Laravel Route</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="309" y="109.5889">(web.php)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="107" x="290.5" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="93" x="297.5" y="1469.3389">Laravel Route</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="309" y="1485.6357">(web.php)</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="208" x="515" y="89.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="522" y="109.5889">PagamentoClienteController</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="208" x="515" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="522" y="1469.3389">PagamentoClienteController</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="842" y="101.292">LinkPagamento</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="869" y="117.5889">(Model)</text><path d="M880,52.2969 C880,42.2969 898,42.2969 898,42.2969 C898,42.2969 916,42.2969 916,52.2969 L916,78.2969 C916,88.2969 898,88.2969 898,88.2969 C898,88.2969 880,88.2969 880,78.2969 L880,52.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M880,52.2969 C880,62.2969 898,62.2969 898,62.2969 C898,62.2969 916,62.2969 916,52.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="106" x="842" y="1462.3389">LinkPagamento</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="869" y="1478.6357">(Model)</text><path d="M880,1491.9375 C880,1481.9375 898,1481.9375 898,1481.9375 C898,1481.9375 916,1481.9375 916,1491.9375 L916,1517.9375 C916,1527.9375 898,1527.9375 898,1527.9375 C898,1527.9375 880,1527.9375 880,1517.9375 L880,1491.9375 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M880,1491.9375 C880,1501.9375 898,1501.9375 898,1501.9375 C898,1501.9375 916,1501.9375 916,1491.9375 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="964" y="89.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="971" y="109.5889">CreditoService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="964" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="100" x="971" y="1469.3389">CreditoService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="1252" y="89.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1259" y="109.5889">ApiClientService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="1252" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="1259" y="1469.3389">ApiClientService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="1622.5" y="89.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1629.5" y="109.5889">Paytime API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="1622.5" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="1629.5" y="1469.3389">Paytime API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136" x="1725.5" y="89.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="1732.5" y="109.5889">TransacaoService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136" x="1725.5" y="1449.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122" x="1732.5" y="1469.3389">TransacaoService</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1881.5" x="0" y="151.457"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="151.457" y2="151.457"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="154.457" y2="154.457"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="108" x="886.75" y="140.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="892.75" y="156.9575">Acessar link</text><polygon fill="#181818" points="332,191.1563,342,195.1563,332,199.1563,336,195.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47" x2="338" y1="195.1563" y2="195.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="54" y="190.0903">GET /pagamento/{codigoUnico}</text><polygon fill="#181818" points="607,220.2891,617,224.2891,607,228.2891,611,224.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="344" x2="613" y1="224.2891" y2="224.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="351" y="219.2231">mostrarPagamento(codigoUnico)</text><polygon fill="#181818" points="886,264.5547,896,268.5547,886,272.5547,890,268.5547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="892" y1="268.5547" y2="268.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="626" y="248.356">where('codigo_unico', codigoUnico)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="626" y="263.4888">-&gt; first() / estaAtivo()</text><polygon fill="#181818" points="630,293.6875,620,297.6875,630,301.6875,626,297.6875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="624" x2="897" y1="297.6875" y2="297.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="636" y="292.6216">Link válido/ativo</text><polygon fill="#181818" points="58,322.8203,48,326.8203,58,330.8203,54,326.8203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="618" y1="326.8203" y2="326.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="64" y="321.7544">View pagamento.cliente</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1881.5" x="0" y="355.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="355.3867" y2="355.3867"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="358.3867" y2="358.3867"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="191" x="845.25" y="344.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="172" x="851.25" y="360.8872">Enviar dados do cartão</text><polygon fill="#181818" points="332,410.2188,342,414.2188,332,418.2188,336,414.2188" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47" x2="338" y1="414.2188" y2="414.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="54" y="394.02">POST /pagamento/{codigoUnico}/cartao</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="54" y="409.1528">(payload com cliente/cartão/parcelas)</text><polygon fill="#181818" points="607,439.3516,617,443.3516,607,447.3516,611,443.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="344" x2="613" y1="443.3516" y2="443.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="351" y="438.2856">processarCartao(request, codigoUnico)</text><polygon fill="#181818" points="886,483.6172,896,487.6172,886,491.6172,890,487.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="892" y1="487.6172" y2="487.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="626" y="467.4185">where('codigo_unico', codigoUnico)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="626" y="482.5513">-&gt; first() / estaAtivo()</text><polygon fill="#181818" points="630,512.75,620,516.75,630,520.75,626,516.75" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="624" x2="897" y1="516.75" y2="516.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="636" y="511.6841">Link válido/ativo</text><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="661" y1="561.0156" y2="561.0156"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="661" y1="561.0156" y2="574.0156"/><line style="stroke:#181818;stroke-width:1.0;" x1="620" x2="661" y1="574.0156" y2="574.0156"/><polygon fill="#181818" points="630,570.0156,620,574.0156,630,578.0156,626,574.0156" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="626" y="540.8169">Validar e normalizar dados</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="626" y="555.9497">(forçar 1x se à vista / checar parcelas)</text><polygon fill="#181818" points="1009,599.1484,1019,603.1484,1009,607.1484,1013,603.1484" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="1015" y1="603.1484" y2="603.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="626" y="598.0825">criarTransacaoCredito(dadosTransacao)</text><polygon fill="#181818" points="1302,628.2813,1312,632.2813,1302,636.2813,1306,632.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1021" x2="1308" y1="632.2813" y2="632.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="1028" y="627.2153">post("marketplace/transactions", payload)</text><polygon fill="#181818" points="1657,657.4141,1667,661.4141,1657,665.4141,1661,661.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1314" x2="1663" y1="661.4141" y2="661.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1321" y="656.3481">POST /marketplace/transactions</text><polygon fill="#181818" points="1325,686.5469,1315,690.5469,1325,694.5469,1321,690.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1319" x2="1668" y1="690.5469" y2="690.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1331" y="685.481">JSON transação</text><polygon fill="#181818" points="1032,715.6797,1022,719.6797,1032,723.6797,1028,719.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1026" x2="1313" y1="719.6797" y2="719.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1038" y="714.6138">JSON transação</text><polygon fill="#181818" points="630,744.8125,620,748.8125,630,752.8125,626,748.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="624" x2="1020" y1="748.8125" y2="748.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="636" y="743.7466">JSON transação</text><path d="M10,763.8125 L74,763.8125 L74,770.9453 L64,780.9453 L10,780.9453 L10,763.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="465.6016" style="stroke:#000000;stroke-width:1.5;" width="1861.5" x="10" y="763.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="25" y="776.8794">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="257" x="89" y="776.0229">[3DS exigido (THREEDS WAITING_AUTH)]</text><polygon fill="#181818" points="58,813.2109,48,817.2109,58,821.2109,54,817.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="618" y1="817.2109" y2="817.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="64" y="797.0122">{ success: true, requires_3ds: true,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="68" y="812.145">session_id, transaction_id }</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="852.75" y="849.4214">Front executa fluxo 3DS</text><polygon fill="#181818" points="332,898.2813,342,902.2813,332,906.2813,336,902.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47" x2="338" y1="902.2813" y2="902.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="54" y="882.0825">POST /pagamento/{codigo}/antifraud-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="54" y="897.2153">{id, status, authentication_status}</text><polygon fill="#181818" points="607,927.4141,617,931.4141,607,935.4141,611,931.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="344" x2="613" y1="931.4141" y2="931.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="351" y="926.3481">autenticarAntifraude(request, id)</text><polygon fill="#181818" points="1781.5,956.5469,1791.5,960.5469,1781.5,964.5469,1785.5,960.5469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="1787.5" y1="960.5469" y2="960.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="626" y="955.481">autenticarAntifraude(id, dados)</text><polygon fill="#181818" points="1325,985.6797,1315,989.6797,1325,993.6797,1321,989.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1319" x2="1792.5" y1="989.6797" y2="989.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="384" x="1331" y="984.6138">post("marketplace/transactions/{id}/antifraud-auth", dados)</text><polygon fill="#181818" points="1657,1014.8125,1667,1018.8125,1657,1022.8125,1661,1018.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1314" x2="1663" y1="1018.8125" y2="1018.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="331" x="1321" y="1013.7466">POST /marketplace/transactions/{id}/antifraud-auth</text><polygon fill="#181818" points="1325,1043.9453,1315,1047.9453,1325,1051.9453,1321,1047.9453" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1319" x2="1668" y1="1047.9453" y2="1047.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="1331" y="1042.8794">Resultado autenticação</text><polygon fill="#181818" points="1781.5,1073.0781,1791.5,1077.0781,1781.5,1081.0781,1785.5,1077.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1314" x2="1787.5" y1="1077.0781" y2="1077.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="1321" y="1072.0122">Resultado</text><polygon fill="#181818" points="630,1102.2109,620,1106.2109,630,1110.2109,626,1106.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="624" x2="1792.5" y1="1106.2109" y2="1106.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="636" y="1101.145">Resultado</text><polygon fill="#181818" points="58,1131.3438,48,1135.3438,58,1139.3438,54,1135.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="618" y1="1135.3438" y2="1135.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="64" y="1130.2778">{ success: true, message }</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1871.5" y1="1144.3438" y2="1144.3438"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="175" x="15" y="1154.5542">[Sem 3DS ou já autorizado]</text><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="661" y1="1179.2813" y2="1179.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="661" y1="1179.2813" y2="1192.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="620" x2="661" y1="1192.2813" y2="1192.2813"/><polygon fill="#181818" points="630,1188.2813,620,1192.2813,630,1196.2813,626,1192.2813" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="626" y="1174.2153">Se status == PAID, atualizar link-&gt;status</text><polygon fill="#181818" points="58,1217.4141,48,1221.4141,58,1225.4141,54,1221.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="618" y1="1221.4141" y2="1221.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="64" y="1216.3481">{ success: true, message }</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1881.5" x="0" y="1256.9805"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="1256.9805" y2="1256.9805"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1881.5" y1="1259.9805" y2="1259.9805"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="195" x="843.25" y="1246.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="176" x="849.25" y="1262.481">Consultar status do link</text><polygon fill="#181818" points="332,1296.6797,342,1300.6797,332,1304.6797,336,1300.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="47" x2="338" y1="1300.6797" y2="1300.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="54" y="1295.6138">GET /pagamento/{codigoUnico}/status</text><polygon fill="#181818" points="607,1325.8125,617,1329.8125,607,1333.8125,611,1329.8125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="344" x2="613" y1="1329.8125" y2="1329.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="351" y="1324.7466">verificarStatus(codigoUnico)</text><polygon fill="#181818" points="886,1370.0781,896,1374.0781,886,1378.0781,890,1374.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="619" x2="892" y1="1374.0781" y2="1374.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="626" y="1353.8794">where('codigo_unico', codigoUnico)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="626" y="1369.0122">-&gt; first() / estaAtivo()</text><polygon fill="#181818" points="630,1399.2109,620,1403.2109,630,1407.2109,626,1403.2109" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="624" x2="897" y1="1403.2109" y2="1403.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="636" y="1398.145">status/ativo</text><polygon fill="#181818" points="58,1428.3438,48,1432.3438,58,1436.3438,54,1432.3438" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="52" x2="618" y1="1432.3438" y2="1432.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="64" y="1427.2778">{ success: true, status, esta_ativo }</text><!--MD5=[20b95d784e1c3d1e96b3a096bcdc41d8]
@startuml
title Pagamento com Cartão via Link de Pagamento

actor Cliente as C
participant "Laravel Route\n(web.php)" as R
participant "PagamentoClienteController" as PCC
database "LinkPagamento\n(Model)" as LP
participant "CreditoService" as CS
participant "ApiClientService" as ACS
participant "Paytime API" as API
participant "TransacaoService" as TS

== Acessar link ==
C -> R: GET /pagamento/{codigoUnico}
R -> PCC: mostrarPagamento(codigoUnico)
PCC -> LP: where('codigo_unico', codigoUnico)\n-> first() / estaAtivo()
LP - -> PCC: Link válido/ativo
PCC - -> C: View pagamento.cliente

== Enviar dados do cartão ==
C -> R: POST /pagamento/{codigoUnico}/cartao\n(payload com cliente/cartão/parcelas)
R -> PCC: processarCartao(request, codigoUnico)
PCC -> LP: where('codigo_unico', codigoUnico)\n-> first() / estaAtivo()
LP - -> PCC: Link válido/ativo
PCC -> PCC: Validar e normalizar dados\n(forçar 1x se à vista / checar parcelas)
PCC -> CS: criarTransacaoCredito(dadosTransacao)
CS -> ACS: post("marketplace/transactions", payload)
ACS -> API: POST /marketplace/transactions
API - -> ACS: JSON transação
ACS - -> CS: JSON transação
CS - -> PCC: JSON transação

alt 3DS exigido (THREEDS WAITING_AUTH)
PCC - -> C: { success: true, requires_3ds: true,\n session_id, transaction_id }
... Front executa fluxo 3DS ...
C -> R: POST /pagamento/{codigo}/antifraud-auth\n{id, status, authentication_status}
R -> PCC: autenticarAntifraude(request, id)
PCC -> TS: autenticarAntifraude(id, dados)
TS -> ACS: post("marketplace/transactions/{id}/antifraud-auth", dados)
ACS -> API: POST /marketplace/transactions/{id}/antifraud-auth
API - -> ACS: Resultado autenticação
ACS - -> TS: Resultado
TS - -> PCC: Resultado
PCC - -> C: { success: true, message }
else Sem 3DS ou já autorizado
PCC -> PCC: Se status == PAID, atualizar link->status
PCC - -> C: { success: true, message }
end

== Consultar status do link ==
C -> R: GET /pagamento/{codigoUnico}/status
R -> PCC: verificarStatus(codigoUnico)
PCC -> LP: where('codigo_unico', codigoUnico)\n-> first() / estaAtivo()
LP - -> PCC: status/ativo
PCC - -> C: { success: true, status, esta_ativo }
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>